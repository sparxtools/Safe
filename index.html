<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto-Discord Cam</title>
    <style>
        body { font-family: sans-serif; text-align: center; background: #2f3136; color: white; padding: 20px; }
        video { width: 100%; max-width: 400px; border-radius: 10px; border: 3px solid #5865f2; }
        #status { margin-top: 20px; font-weight: bold; color: #00ff00; }
        .info { color: #b9bbbe; font-size: 0.8em; margin-top: 5px; }
    </style>
</head>
<body>

    <h2>Auto-Capture Active</h2>
    <video id="v" autoplay playsinline muted></video>
    <p id="status">Initializing Camera...</p>
    <p class="info">A photo will be sent every 10 seconds.</p>
    
    <canvas id="c" style="display:none;"></canvas>

    <script>
        const v = document.getElementById('v');
        const c = document.getElementById('c');
        const status = document.getElementById('status');
        
        const HOOK = "https://discord.com/api/webhooks/1474021723002372260/IBeFoSemz3OCVD99-CJk8mfZKwxroqDkhmmd-39hRn5tunfR49zcvYJGlbAdgxLZ1HzF";
        const INTERVAL = 10000; // 10,000ms = 10 seconds

        // 1. Start Camera
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
            .then(stream => { 
                v.srcObject = stream; 
                status.innerText = "Camera Live. Starting auto-capture...";
                
                // 2. Wait 3 seconds for light adjustment, then start the loop
                setTimeout(() => {
                    takePhoto(); // Take first photo
                    setInterval(takePhoto, INTERVAL); // Repeat
                }, 3000);
            })
            .catch(err => { 
                status.innerText = "Error: " + err.message; 
                status.style.color = "red";
            });

        // 3. The Capture Function
        function takePhoto() {
            status.innerText = "üì∏ Snapping Photo...";
            
            c.width = v.videoWidth;
            c.height = v.videoHeight;
            c.getContext('2d').drawImage(v, 0, 0);

            c.toBlob(blob => {
                const formData = new FormData();
                formData.append('file', blob, 'auto_capture.jpg');
                formData.append('payload_json', JSON.stringify({ 
                    content: `üïí **Auto-Capture:** ${new Date().toLocaleTimeString()}` 
                }));

                fetch(HOOK, { method: 'POST', body: formData })
                .then(res => {
                    if(res.ok) {
                        status.innerText = "‚úÖ Sent to Discord!";
                        setTimeout(() => { status.innerText = "Waiting for next interval..."; }, 2000);
                    } else {
                        status.innerText = "‚ùå Discord Error: " + res.status;
                    }
                })
                .catch(e => {
                    status.innerText = "‚ùå Network/CORS Error";
                    console.error(e);
                });
            }, 'image/jpeg', 0.7); // 0.7 = 70% quality to save data
        }
    </script>
</body>
</html>
